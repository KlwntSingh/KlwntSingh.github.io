---
title: FTNT NSE4
layout: post
---
    
# Topics

## Firewall Policies 
* controlling networking access 

## Security Fabric 
* identifying characteristics of security fabric 
* enabling components in FGT to extend the functionality 

## NAT 
* source nat 
* destination nat 
* port forwarding 

## Web Filtering 
* security profiles to neutralize threats by blocking virus, torrents, malicious sites etc 

## Application Control 
* to monitor and control network applications 

## Antivirus 

## Authentication 
* authenticate users with firewall profiles 

## Logging and Monitoring 
* collect and interpret 

## Certificate operations 
* encryption and certificate functions 
* ssl traffic inspection 

## Intrusion systems and DOS 

## SSL VPN 

---
# chapter 1

## High-Level 
* #### Deployment modes 
	* Distributed enterprise firewall 
	* Next generation firewall 
	* Internal segmentation firewall 
		* used to contain network breach 
	* Data center firewall 
		* monitor inbound requests to servers and protect them without increasing latency to requester 
* #### Notes 
	* Security perimeter is no longer solid. malicious actors can penetrate this perimeter very easiliy be it malicious usb, compromised employee's device connected to corporate network etc. 
		* Different things to consider in perimeter 
			* mobile workforce 
			* partners accessing your network 
			* public, private clouds 
			* IOT 
			* BYOD 
	* FGT is modular, meaning you can enable features which are useful to you and disable others. Add other FTNT products to improve efficiency and security. 
		* eg:- rather than buying separate security appliances, single FGT is enough with UTM(unified threat management) for smaller-mid size business 
	* Virtualizaton 
		* FGT VM 
			* does not have spu's like physical fgt has 
			* used when you need fast deployment and tear down in large number with similar cheap hardwares 
		* FGT VMX 
			* replaces network component of VMware nsx to provide additional security between network traffic of guest vm's hense giving east-west flow 
		* Cisco ACI connector 
			* alllow aci to deploy fgt for north-south flow 
	* hardware acceralation offloads processing from cpu to asics. Sessions offloaded can be seen in gui. per-session accounting enables to see all the sessions offloaded 
* #### ASICS 
	* SPU 
		* Security processing Units 
		* NP 
			* Network Processor 
			* for packet forwarding incase of high volume traffic 
			* directly attached to network interface 
			* NTurbo 
				* offloads flow based security profiles to NP6, NP7 network processors 
			* eg:- NP7, NP6, NP6lite processor 
	* CP 
		* Content processor 
		* for virus scanning, attack detection, encryption/decryption 
		* not bound to interface, closer to application 
		* eg:- CP9 
	* SP 
		* Security processor 
		* provides IPS 
		* 1. directly attached to interface2. can work at system level too 
		* eg:- SP3, LP, XG2, XE2, FE8 andCE4 
	* SoC 
		* entry level optimizations 
		* Nturbo included 
		* eg: SoC4(entry level) - with CP, NP and RISC CPU 

## Setup 
* #### vdoms 
	* by default disabled. 
	* one vdom is always there even if disabled, root vdom 
	* vdom is concept of dividing FGT into multiple virtual FGT as if they were separate FGT's 
* #### default conf 
	* ping, http, https and ssh enabled. these are mostly called management protocols 
	* NAT mode with single vdom(root vdom) 
	* Fortiguard access is anycast to optimize routing performance. anycast forces use of https protocol 
* #### two modes 
	* NAT 
		* FGT as router 
		* default mode 
	* Transparent 
		* FGT as switch/bridge 
		* one of interface has ip for management 
* #### port 
	* dedicated physical management port 
		* only on high end models 
	* usb management port/ console port 
		* used to manage FGT without network 
	* ports 
		* can be used to access FGT and management of it 
		* also called internal interfaces 
		* management protocols are used here to management FGT [anchor](xmind:#6a26bmjcna28n9ejcvdohilegm "anchor")
* #### fds 
	* for package updates 
		* avdb, ips db 
			* since no frequent changes in db so downloaded once a day 
		* update.fortiguard.net [anchor](update.fortiguard.net "anchor")
		* port - 443 
	* live queries 
		* Web Filtering, DNS Filtering and antispam 
			* db's are not downloading because of their size and frequent changes 
		* service.fortiguard.net [anchor](service.fortinet.net "anchor")
		* servicewf.fortiguard.net [anchor](servicewf.fortiguard.net "anchor")
		* port - udp 8888, ssl 443 
			* here protocol requirements is speed and not fault tolerance 
	* Fortiguard implements OCSP stapling technique to get certificate status and then this status if used by FGT to verify certificate efficiently. Fortiguard queries OCSP check every 4 hrs 
	* FGT aborts connection to Fortiguard if: 
		* cn in certificate does not match the domain name resolved from dns 
		* ocsp status not good 
		* issuerCA revoked by rootCA 

## Basic Administration 
* #### methods 
	* cli 
		* console, telnet, ssh, gui cli widget 
		* reports cannot be viewed here 
	* gui 
		* fortiexplorer 
		* browser using http/https 
		* advanced settings and diagnostics commands for super user not available here 
	* other administrative protocols 
		* snmp 
			* ready-only, can't be used for setup 
* #### users 
	* there should be separate user accnt for diferent administrators. helpful in tracking and tracking purposes 
	* authentication can be using passwords, remote auth servers, digital certificates and fortitoken 
	* when resetting lost password 
		* maintainer user accnt by default. username - maintainer, password - bcpb<serialnumber>. Note: this accnt is only active for around 60 after power cycle 
			* this maintainer accnt can be disabled but then you also loose the way to reset password 
		* reset to factory default 
* #### admin profiles 
	* defines scope of action by assigning set of permissions to user 
	* super_admin 
		* assigned to admin user, cannot be changed 
	* prof_admin 
		* same as super_admin but assigned to limit permissions to individual vdom and can be changed 
	* inactivity_timeout is per-profile setting 
	* users with lower set of permissions cannot even users with more permissions 
* #### Administrative Access 
	* multi-factor auth 
	* trusted hosts 
		* by default conf is 0.0.0.0/0 
		* when administrators login from ip different from one configured in trusted host, then they don't get auth failure but rather 'Unable to contact server' 
		* NATed translation defeats trusted hosts 
	* ports 
		* http,https,ssh,telnet ports are customizable 
	* password policy 
		* defining criteria what should be there is password line numbers, special character etc 
	* idle timeout 
		* default 5 minutes 
		* this can be overridden by setting in profiles [anchor](xmind:#2tobpfov8nplt7jrdgkj65hdjn "anchor")
		* shorter more secure 
	* concurrent sessions 
	* protocols 
		* management protocols [anchor](xmind:#6a26bmjcna28n9ejcvdohilegm "anchor")
			* separate for both ipv4, ipv6 and it's per interface 
			* telnet, ipv6 is hidden by default 
			* insecure protocols like http and telnet should not be used 
		* protocols where FGT is destination ip 
			* security fabric 
				* capwap 
					* fortiap, fortiextender, fortiswitch 
				* fortitelemetry 
			* fmg-access 
				* for communication with fortimanager 
			* ftmfortitoken mobile push 
				* supports two-factor auth requests from fortitoken app 
			* radius accnting 
				* for processing radius accounting packets for single-sign on 
		* LLDP 
			* detecting upstream security fabric 
	* hidding features(feature visibility) 
		* ipv6 hidden by default 
		* multiple interface policies 
			* enable/disable to put multiple interfaces in policies 
		* hidding feature does not disable it. it works in background 
		* allow unnamed policies 
			* to have firewall policies without name in gui but in cli policies can already exists without name 
		* voip security profile is hidden by default 
		* policy advanced option diabled by default 
			* by assigning policy id when creating policy from gui 
* #### Interface types 
	* physical interface 
		* port to interface direct mapping 
	* link aggregation 
		* logical channel consisting of multiple ports for increased bandwidth and high availability by providing redundancy 
	* zones 
		* logical grouping of interfaces 
		* once added to zone, interface cannot be referenced individually 
* #### Interface IP 
	* NAT 
		* NAT mode always require ip on interface since FGT is now acting as router 
		* three ways to assign ip 
			* dhcp 
			* ppoe 
			* manual 
	* one-arm sniffer 
		* when interface is selected as one-arm sniffer, interface receives copy of packet from mirrored port on switch 
* #### Interface roles 
	* roles is basically preconfigured interface settings grouped together to avoid misconfiguration 
		* eg: wan role has disabled all dhcp server and device detection related configuration in gui 
	* 4 types 
		* wan 
		* lan 
		* dmz 
		* undefined 
			* shows all settings 
* #### interface alias 
	* friendly interface description or interface name 
	* you can label them by purpose 
* #### static gateway 
	* gateway should be added in FGT so that i can forward the packet to next router for further routing 
	* if ip address received is by dhcp/ppoe then it must have received default gateway otherwise we have create default static route 

## Servers 
* #### dhcp 
	* when ip addr on interface is manual, we can select it to act as dhcp server 
	* three types ip assignment rules 
		* assign ip 
		* block 
		* reserve ip 
* #### dns 
	* enabled per interface 
	* dns database can be shared by all interfaces but can be separate for vdoms 
	* resolution methods 
		* forward 
			* relay requests to configured dns server in system settings. it act as relay server and not as dns server 
		* non-recursive 
			* use internal dns database only 
		* recursive 
			* use internal dns database and if no result found forward to it next server 
	* dns database 
		* dns zones 
			* each dns zone has it's own domain name 

## Fundamental maintainence 
* #### configuration backup 
	* we can have separate configuration backup for separate vdoms 
	* when encrypting configuration file with password, it can only be decrypted on FGT with same model and firmware. encrypted configuration file has header in plaintext which includes model, firmware release number and build number and rest of file is encrypted and unreadable 
	* for unencrypted file, file can be restored only on FGT with same model number 
* configuration restore 
* #### dowgrade firmware 
	* read release notes before doing downgrade 
	* translation scripts convert configuration from prev version to downgraded version 
* #### upgrade firmware 
	* read release notes before doing upgrade 
	* translation scripts convert configuration from prev version to upgraded version 
* #### firmware 
	* firmware is basically fortios release number with build number 
* #### reason to have physical access 
	* when downgrading/upgrading is using unsupported paths, translation scripts might loose settings 
	* firmware which you are uploading is corrupted 
	* older firmwares do not have ability convert later configurations 

---
# chapter 2

## basic concepts 
* #### attributes 
	* broad 
		* covering wide spectrum of attack surface 
	* integrated 
		* covers whole range products working together 
	* automated 
		* data is shared among application in real time 
* #### comprise 
	* core 
		* 2 * FGT 
		* FAZ 
	* recommended 
		* FCT 
		* FortiManager 
		* FortiAP 
		* FortiSwitch 
		* Fortisandbox 
		* fortimail 
	* extended 
		* other fortinet and third party products 

## deploying security fabric 
* #### root FGT 
	* enable security fabric connection on interfaces facing downstream FGT's 
	* on fabric connector page, configure edge FGT as root FGT and configure FAZ on this FGT 
	* you can pre-authorize downstream FGT's by adding their serial number 
* #### downstream FGT 
	* enable security fabric connection on interfaces facing upstream FGT 
	* On Fabric connectors page, join existing fabric put in root FGT ip 
* now authorize downstream FGT's on upstream FGT and both downstream and upstream on FAZ 
* #### split-task vdoms 
	* root vdom 
	* global vdom 
	* FG-traffic vdom 
* #### device identification 
	* agentless 
		* requires direct connection with FGT meaning there is no layer3 device between endpoint and FGT 
		* devices are indexed by mac addr 
		* HTTP user-Agent header, TCP fingerprint, MAC address OUI, andFortiOS-VM detection methods 
	* FCT 
		* location and infrastructure independent 
		* devices are indexed by fct user id(UID) 
	* needs to be enabled on interfaces 

## Extending the fabric 
* #### integrations 
	* central management integrations 
		* fortimanager 
	* fortimail integration 
		* fortimail 
	* web application integration 
		* fortiweb 
		* fortiCache 
	* forticlient integration 
		* ems 
	* advanced threat protection integration 
		* fortisandbox 
	* access device integration 
		* fortiap 
		* fortiswitch 
* #### automatic stiches(actions) 
	* events triggers actions 
	* some triggers used IoC(indicator of compromise) from FAZ 
	* minimum interval 
		* time between event detected and action triggered 
	* threat level threshold 
		* defines minimum criteria required for action to be fired when event detected 
	* Automated threat response 
		* by triggering any action configured 
		* push notifications or notifications in FGT gui 
* #### external connectors 
	* aws 
	* oci 
	* gcp 
	* azure 

## security fabric status widget 
* name of fabric 
* fgt devices in security fabric 
* #### representation different devices in fabric 
	* blue 
		* connected to your fabric 
	* grey 
		* unauthorized connected to your fabric 
	* red 
		* not detected in your fabric but recommended for fabric 
	* attention icon 
		* fgt waiting for authorization 
* #### security fabric posture widget 
	* latest security rating for security fabric 
	* security ratings are calculated using security audits are automated and can run on demand. security audit generate reports which are sent to fortiguard for analysis and get security posture score 
	* you can compare security rating to other organizations in same industry or organization of all industries or to your organization region or all regions 
	* you should have valid security rating license in all the FGT's 
	* security posture ranking by percentile from fortiguard 

## security fabric rating 
* this is fortiguard subscription based rating service 
* #### scorecards 
	* security posture 
	* fabric coverage 
	* optimization 
* this audit/test is against FSBP and PCI compliance and standards 
* security posture score is per security fabric group 

## topology views 
* #### physical 
	* bubble size of devices is acc. to traffic volume 
	* grouped acc. to upstream device they are connected to 
* #### logical 
	* it shows interfaces used to connect device in security fabric 
* authorize/deauthorize access devices(fortiap, fortiswitch) 
* ban/unban client devices 

---
# Chaper 3

## matching criteria 
* when packet arrives, fgt start matching it with policies from start and as soon as match found respective action is triggered. if no matching policy found, implicit deny drops the packet 

## comparison of policies 
* #### firewall policies 
	* implicity deny 
	* limit access to network 
* #### security profile 
	* protects network, utm protection for virus, web filtering and application control 
	* security profile process packets when firewall policy has allowed the traffic 
	* implicit allow 
		* because no matching malware signature found in packet, it should be allowed 
	* when inspecting traffic, are two ways 
		* flow based 
		* proxy based 

## components of policy 
* #### objects 
	* interfaces, zones, nat rules, security profile, schedules, service definations, users 
	* interface 
	* nat rules 
		* VIP objects 
			* they are different from address objects. 
				* policiy with address object will not match VIP traffic 
				* to make policy match you can enable match-vip from cli or just change address object to VIP 
			* when both VIP and address object policies are configured, VIP policy is checked first 
	* IP pool 
* #### types 
	* ipv4, ipv6, multicast etc 
* #### matching criteria 
	* incoming interface 
	* outgoing interface 
	* source 
		* ip, user, internet service(ISDB) 
		* address 
			* ip 
			* subnet 
			* fqdn 
				* if selecting fqdn as source then dns need to resolve on FGT, other policy will show warning 
			* geography 
				* defines group of range of addresses allocated to country 
				* fortiguard updates database periodically 
			* fabric connector address 
		* user 
			* user is authenticated before allow/deny access based on policy 
			* three types of users 
				* local 
				* remote - radius, ldap 
				* FSSO 
		* ISDB 
			* database with ip, protocol and port numbers used by most common internet services 
			* regularly updated by fortiguard 
			* if this is used as source, we can't use address with this 
			* if this is used in destination, we can't use address or services 
			* eg: FB, dropbox, AWS etc 
			* geoghraphy based ISDB 
				* more fine grained control over service based on country, region, city 
				* created by users 
		* combinations 
			* ip and user can go together 
			* ip and ISDB can't go together 
	* destination 
		* ip, internet service 
		* same as source 
		* there is no user in destination because user identification is only on ingress interface and once user is identified then it can be send to egress interface 
	* service 
		* ip protocol and port number 
		* can be pre-defined or custom 
		* mostly destination port is defined because in modern applications source port is random 
		* eg:- http, https 
		* policy for dns service must be added explicity even though it is kind of base protocol 
	* schedule 
		* applies during configured time 
* #### scheduling 
	* policies applying only during specific time and day 
	* types 
		* recurring 
			* happens at same time during specified days of week 
			* if all day selected, policy will be active for 24 hrs 
			* if stop time is earlier than start time, it will stop next day 
			* if start and stop time are identical, then it will run for 24 hrs 
		* one time 
			* start time must be earlier than stop time 
			* pre-expiration event log, logging n day before schedule expires, 1<=n<=100days 
* #### other options in policies 
	* such as firewall and network options, security profiles, logging options, and enabling or disabling a policy 
	* security profile [anchor](xmind:#32n1m9p6blmb4qgh5jcftoia76 "anchor")
	* logging 
		* by default, Log Allowed Traffic set to security events i.e logs for applied security profiles. can be changed to all sessions 
		* log is generated after firewall policy closes the session 
		* option to enable generate Logs when Session Start 
			* if internal storage is not present then this is cli-only option, logtraffic-start 
		* during session, if policy detects violation, logs immediately. 
			* to improve performance, we can enable session table entry for denied sessions which will automatically deny all packets for denied session and also will not do policy lookup for packets in denied session hence reducing cpu usage and log entries. This option is in cli-only ses-denied-traffic and by default timeout is 30 seconds 
	* traffic shappers 
		* can provide 
			* maximum bandwidth 
			* guaranteed bandwidth 
		* types 
			* shared 
				* bandwidth management of security policies using same shaper 
			* per-ip 
				* bandwidth management of user ip addr 
			* application control 
				* bandwidth management by application 
		* udp traffic may not gracefully recover from packet loss 
	* consolidated policies 
		* both ipv4, ipv6 can exists in firewall policies only condition that ip version in source and destination should match. 
		* when upgrading from 6.2.3 to 6.4, consolidated policies will change to firewall policies 
* when policy is created UUID is added which improve integration with fortimanager and FAZ 
* since firewall policies are stateful, only one direction flow of traffic that initiates the session is required, fgt automatically handles replies. In Ipsec it is called NAT--T 

## managing policies 
* #### policy list 
	* interface pair view 
	* by sequence 
		* this sequence is not same as sorting by id but by precedence order 
	* when multiple sources/destinations/any are selected then they can't be lsited in interface pair view 
* #### Real time policy usage 
	* when we edit poilcy, on right side it shows details of policy usage 
	* last used, first used, hit count, active sessions, total bytes, current bandwidth 
* #### Policy id 
	* unique identifier for policies 
	* it does not define precedence order of policies 
	* fgt automatically assigns policy id when policy is created 
	* policy id does not change when changing precedence order 
	* they are not shown by default on gui, to enable you have to add Policy Id as column in table 
* #### grouping 
	* we can group services and adresses togethr and add that into policy instead of adding multiple services/adresses 
* #### Ref 
	* we can't delete object until ref is 0 
* #### fine tuning 
	* enabling/disabling 
	* inserting firewall policies below or above 
	* copying and pasting policies 
	* clone reversing 
		* if nat is disabled 

## Best practices 
* #### characters allowed in name 
	* number 0-9 
	* letter a-z, A-Z 
	* special character, hyphen and underscore 
		* some of special characters are allowed in passwords, comments and replacement messages 
	* spaces 
		* avoid spaces in general because can cause problem when editing from cli 
* #### things to consider when creating policies 
	* always write test case for few ip addresses before implementing a change in maintainence windows. changes are applied immediately 
	* try to match firewall policies as specifically as possible 
	* analyze and enable appropriate settings on per-profile basis 
		* security profiles 
		* logging settings 
* #### policy order 
	* more specific policies should be on top and general policies below 
* #### policy lookup 
	* for finding matching policy without real traffic 
	* input criteria changes as you select service type 
		* eg: when you select tcp, you can put source ip, source port, destination ip and destination port but when you select icmp, you put icmp request/reply type/code, ip 
	* does not consider disabled policies 

---
# Chapter 4

## terms 
* #### PAT 
	* map multiple private ip address to single public ip address using different ports 
* #### NAPT 
	* nat and pat together 
* #### SNAT 
	* usually for outgoing connections 
	* two ways 
		* uses outgoing interface address 
			* also called as many-to-one NAT 
				* many internal ip addresses are mapped to 1 egress interface ip 
			* PAT 
				* source port and source ip is mapped to egress interface ip + allocated source port 
			* fixed port 
				* here if more than 1 connection uses same source port then later connections will be dropped. here source port is kept same in translation 
		* ip pool 
			* types 
				* overload 
					* default 
					* can be many-to-one or many-to-few and port translation 
					* same behaviour as PAT 
				* one to one 
					* no PAT 
					* mapping are not fixed. 
					* if there are no more addresses available, connections are refused 
				* IP Pool - fixed port 
					* no pat 
					* same behaviour as fixed port in outgoing inteface address translation 
					* if no more address available then connection refused 
				* port block allocation 
					* assigns block of port address to each host 
					* limits port usage per host 
			* ip pool is in same range as egress interface ip address. 
				* Pool range can be something else only if appropriate routing is configured 
* #### DNAT 
	* translating destination ip address 
	* used for incoming traffic i.e VIP's. VIP's are DNAT objects 
	* uses configured VIP address as destination address 
	* usually public internet address is translated to private network address 
	* two types 
		* static-nat 
			* restricted to forward on certain ports 
				* map external interface port 100443 to internal ip at 443 
			* outgoing policy with NAT enabled will use VIP rather than egress interface ip, can be overridden using IP pool 
			* default 
		* load-balanced 
			* distributes incoming connections to multiple internal addresses 
		* server-load-balance 
			* builds on this mechanism, provides session persistence and server availibility check 
* #### NAT64 
	* mechanism allowing communication between ipv6 and ipv4 addresses 
* #### NAT46 
	* mechanism allowing communication between ipv4 and ipv6  addresses 
* #### NAT66 
	* mechanism allowing communication between ipv6  addresses 

## why? 
* #### for improved security 
	* addresses behind NAT are virtually hidden 
* #### amplication of addresses 
	* hundereds ot addresses can use few public ip addresses 
* #### internal address stability 
	* even if ISP change, internal addresses doesn't have to change 

## two ways to use nat 
* #### individually on firewall policies 
	* usually used in more simple scenarious where we have less pool of NAT ip addresses 
* #### central NAT 
	* per-vdom 
	* automatically applies to multiple firewall policies 
	* we should configure them specifically so that they can only be applied to specific firewall policies 
	* can be enabled/disabled on cli only 
		* after enabling in cli, two gui options will be available 
			* central nat 
				* SNAT 
			* DNAT & VIP's 
		* config system settingsset central-nat enable 
	* all VIP and IP pool references must be removed from existing policies when enabling central NAT 
	* it is mandatory for NGFW policy based mode 
	* matching central nat is same as matching firewall policy 
		* if no matching central nat rule exists, no nat is applied 
		* matching ceriteria 
			* source interface 
			* destination interface 
			* source address 
			* destination address 
			* protocol 
			* source port 
		* they are matched like firewall policies, from top to bottom 
	* central DNAT 
		* when creating VIP, a rule is automatically created in kernel to allow DNAT to occur 
			* firewall policy stills needs to be created for VIP mapped ip addr as destination addr 
		* to granularly control DNAT, you can define firewall policies but can't use VIP, use mapped ip address of VIP as destination addr 
		* there is services option when creating VIP, making it granular what kind of services and port you want access from outside 
	* when disabling 
		* SNAT 
			* Central SNAT table will no longer be used for ingress-to-egress traffic 
			* to enable individual firewall policy based, you have to manually edit firewall policies to enable nat 
		* DNAT 
			* it will stop working since no rule in kernel for DNAT 
			* to enable individual firewall policy based, you will have to edit egress-to-ingress firewall policies to add VIP 

## session helpers 
* used to analyze data in packets of certain protocols 
* #### to show configured session helpers 
	* show system session-helper 
* #### for more advanced application tracking and control, ALG(Application Layer gateway) can be used 
	* eg: VOIP profile 
* #### eg of session helpers 
	* ftp 
		* two types control and data packet 
	* SIP 
		* application layer has addresses from network and transport layr 
		* so these addresses in application are translated when NAT is enable to translate network layer addresses 

## Session tables 
* #### sessions tables are created in Kernel 
	* source and destination addresses 
	* port pairs 
	* source and destination interfaces 
	* source and destination NAT Translations 
	* state 
	* timeout 
		* ttl 
	* performance metrics like 
		* maximum concurrent sessions 
		* new sessions per seconds 
* session tables hold only what is known or processed by CPU 
* information about Sessions and connections handled by security processor or special processors is not present in session tables 
* #### session ttl 
	* when session table is full, to improve performance, sometimes it is necessary to close sesions earlier 
	* can cause lot of connections errors when session closed too soon 
	* timers can be configured wtih following precendence 
		* firewall services > firewall policies > global sessions 
* #### diagnostics 
	* diag sys sessions 
		* base command with command actions 
		* config sys sessions filter ? 
			* apply filters 
			* dport 
			* sport 
			* policy 
			* dst - ip addr 
		* diag sys session list 
			* list sessions acc. to applied filter 
		* diag sys session clear 
			* purge sessions acc. to applied iflters 
		* diag sys session filter clear 
			* clear previously applied filters 
	* get system session list 
		* brief list of sessions 
* #### session state 
	* TCP 
		* session state is single digit but FGT keep proto_state as 2 digit 
			* one digit is for state of outgoing request(client side) and other is for incoming response (server side) 
		* NONE 
			* 0 
		* ESTABLISHED 
			* 1 
		* SYN_SENT 
			* 2 
		* SYN $ SYN_ACK 
			* 3 
		* FIN_WAIT 
			* 4 
		* TIME_WAIT 
			* 5 
		* CLOSE 
			* 6 
		* CLOSE_WAIT 
			* 7 
		* LAST_ACK 
			* 8 
		* LISTEN 
			* 9 
	* UDP 
		* udp is stateless but FGT still keeps track of proto_state 
		* 00 
			* udp traffic one way 
		* 01 
			* udp traffic two way 
			* for remainder of communication is 01 
	* ICMP 
		* has no state 
		* always 00 

## Best practises 
* #### checking NAT issues using logs 
	* traffic logs must be enabled, check in gui Log & Reports > log settings 
* #### NAT Port exhaustion 
	* means FGT is unable allocate any port new sessions 
	* either increase pool size so it load balances 
	* decrease number of connections requiring NAT 
	* log 
		* NAT Port is exhausted 
	* diagnostic command 
		* diag sys session stat 
			* there is 'clash' counter and if value > 0 means there are number of sessions rejected because of no port available 
		* diag firewall ippool-all list 
			* list all nat ip pools with range and type 
		* diag firewall ippool-all stats <OPTIONAL IP POOL NAME> 
			* stats of ip tools sessions, tcp sessions, udp and other sessions per pool 
* #### avoid mis configuration of ip pools 
	* double check start and end of pool 
	* ip pool does not overlap with address assigned to FGT and hosts 
	* don't use NAT for inbound traffic unless absolutely required 
	* if internal and external users are accessing same servers, use split dns to provide internal ip to internal users rather than letting them use VIP to reach servers 
	* Subtopic 5 

---
# Chapter 5

## ways 
* ip 
* device 
* #### user 
	* individual can be tracked across devices 
	* methods 
		* local password auth 
		* server based password auth 
			* remote auth using RADIUS, LDAP, POP3, TACACS+ 
				* POP3 uses email for authentication. this email can be with domain name or with just a suffic 
					* only configurable from FGT cli 
				* LDAP 
					* can be configured with email or username 
				* other just uses username 
			* when multiple devices needs to authenticate using same users 
		* two factor auth 
			* enabled on top of existing method 
			* FGT OTP 
				* FortiToken 
					* Fortitoken 200 
						* hard token 
							* serial number act as initial seed value 
						* generates 6 digit code every 60 seconds 
						* algorithm on both fortitoken device and auth server uses same time and same seed to generate token and auth users. NTP is recommended to keep time in sync 
					* Fortiotken mobile 
						* simply popups auth request to confirm if session is valid 
						* soft token 
							* activation code act as seed value 
						* FGT provides 2 free activations 
					* can be delivered using SMS and email 
				* if you want to use token on multiple devices, then use central validation server like FortiAuthenticator, Fortitoken will be assigned to users on FAC 
				* you cannot register same fortitoken on multiple devices but can use validator server like FAC to achieve using FortiToken for users on multiple devices 

## methods 
* #### active 
	* user receive prompt for credentials 
	* POP3, LDAP, RADIUS, TACACS+ 
	* local password, server based, two factor auth 
* #### passive 
	* automatically authenticated 
	* using FSSO, RSSO(radius single sign on), NTLM 

## protocols 
* #### LDAP 
	* TCP port 389 
	* It is protocol for accessing and maintaining distributed directory information services 
	* supports number of operations 
		* compare, search, add/delete entry 
		* binding is operation used to authenticate user 
	* ldap structure is like a tree and that contains object/entries in each branch 
		* entries has unique ID called DN  ( Distinguished  name ) 
			* eg: ou=people, dc=example, dc=com 
		* DN has attributes 
			* each attribute has name and more values 
			* attributes are defined in directory schema 
		* root of directory represent organization itself and is called DC ( Domain Component ) 
			* eg: DC is usally a domain name as example.com(It is represented as dc=example, dc=com) 
		* All the other entries are added to hierarchy as needed. They can be from either of two types of object - containers, leafs 
			* containers 
				* object that can include/hold other objects like directory 
				* Country, represent by c 
				* Organization Unit, represented by ou 
				* Organization, represented by O 
			* leafs 
				* end of each branch and have no subordinate object 
				* user id, represented by uid 
				* common name, represented by cn 
	* Since FGT act as LDAP client, hence it also understansd LDAP tree structure 
		* Common Name Identifier 
			* this represent attribute name used to find user 
			* eg:- cn, uid 
		* Distinguished Name 
			* identifies top of tree where user might be located 
		* Bind Type 
			* simple 
			* regular 
				* if we are searching user across multiple domains and require users cred to perform ldap queries 
			* anonymous 
		* test connection button only test reachability to ldap and does not test user cred 
		* to test user creds to ldap, use cli 
			* diagnose test authserver ldap <servername> <username> <password> 
* #### RADIUS 
	* standard protocol that provides AAA services 
	* types of request/response 
		* Access-request 
			* when client sends user creds for auth to server 
		* Access-Accept 
			* response when user credentials are ok 
		* Access-Reject 
			* response when server rejects provided credentials 
		* Access-Challenge 
			* response when server is asking for additional passwor, token etc. 
			* used when two factor authentication is turned on 
	* Conf in FGT 
		* Primary server ip/name 
			* ip or fqdn of radius server 
		* primary server secret 
			* Values is same as one configured on radius server 
			* FGT must be listed on radius server too for it to entertain requests 
		* authentication method 
			* chap, pap, mschap, mschap2 
		* testing radius cred from cli 
			* diagnose test authserver radius <servername> <auth_method> <username> <password> 
	* FTNT has proprietary attributes to extend functionality of radius 

## user groups 
* #### types 
	* firewall 
	* guest 
		* most commonly used for guest access in wireless networks 
		* administrator can create many guest accounts to give to wireless network users 
		* these accounts are temporary accounts 
	* fsso 
	* rsso 
* groups can be assigned to firewall policies to control access to network resources 
* #### what can we add to user groups 
	* local user 
	* remote user 
	* remote groups 
		* we can add remote server groups to user groups by adding remote server and then selecting specific group while configuring user groups 
	* pki user 
		* certificate user 

## Adding auth in firewall policies 
* #### objects that can be added to firewall policies 
	* user 
	* user group 
	* fsso users 
	* pki users 
* auth objects are added in source field of policy 
* DNS traffic is allowed even without user auth or user auth failed 
* #### policies must allow protocol which can be used to show authentication dialog to user 
	* eg: http, https, telnet, ftp 
	* all other services are not allowed until user has successfully authenticated 
	* this is true only for active authentication where user/password/token is required from user to auth. 
	* passive authentication works behind the scene hence policies will even without these protocols will work 

---
# Questions

## can we assign individual user to firewall policies for auth 
* yes ca be added 

## check my fortigate if i have configured policy for dns service? 

---
